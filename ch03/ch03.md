# 3. OpenCV 주요 클래스

## 3.1 기본 자료형 클래스

### 3.1.1 Point_ 클래스
- Point_ 클래스는 2차원 평면 위에 있는 점의 좌표를 표현하는 탬플릿 클래스
- Point_ 클래스는 2차원 좌표를 나타내는 x와 y라는 이름의 맴버 변수를 가지고 있음
- 간략화한 Point_ 클래스 정의를 src\ch03_1 프로젝트 파일에 구현 `주석 3-1`

<hr>

- Point_ 클래스는 템플릿 클래스이기 때문에 실제로 사용할 때에는 어떤 자료형으로 좌표를 표현할 것인지를 명시해야 함
  - 예를 들어 정수 좌표를 표현하려면 Point_<int> 클래스를 사용
- 다만 Point_ 클래스를 사용할 때마다 자료형을 명시하는 것이 다소 번거로울 수 있어서 OpenCV는 자주 사용하는 자료형에 대하여 Point_ 클래스 이름을 재정의하여 제공
  - 즉, 정수형 int 자료형으로 점의 좌표를 표현하려면 Point2i 클래스를 사용하고, float 자료형을 사용하려면 Point2f 클래스를 사용
- 정수형 좌표를 표현하는 경우가 많기 때문에 Point2i 클래스는 좀 더 일반적인 이름인 Point 클래스로 다시 재정의
- 그러므로 OpenCV 소스 코드에서 Point 클래스는 2차원 정수 좌표계에서 좌표를 표현하는 자료형으로 취급하면 됨

<hr>

- 2차원 정수 좌표계에서 점의 좌표를 표현하는 방법을 src\ch03_1 프로젝트 파일에 구현 `주석 3-1-1`

<hr>

### 3.1.2 Size_ 클래스
- 영상 또는 사각형의 크기를 표현할 때에는 Size_ 클래스를 사용
- Size_ 클래스는 사각형의 가로와 세로 크기를 나타내는 width와 height 맴버 변수를 가지고 있음
- 간략화한 Size_ 클래스 정의를 src\ch03-1 프로젝트 파일에 구현 `주석 3-2`

<hr>

- Point_ 클래스와 마찬가지로 Size_ 클래스도 탬플릿으로 정의되어 있으며, 다양한 자료형에 대해 이름이 재정의되어 있음
  - 사각형 영역의 가로 및 세로 크기를 int 자료형으로 표현하려면 Size2i 클래스를 사용하고, float 자료형을 사용하려면 Size2f 클래스를 사용
- 정수형으로 가로, 세로 크기를 표현하는 경우가 많기 때문에 Size2i는 다시 Size라는 이름으로 재정의되어 있음
  - 즉, Size 클래스는 정수형 맴버 변수 width, height를 가지고 있는 사각형 크기 표현 클래스

<hr>

- 2차원 정수 좌표계에서 크기를 표현하는 방법을 src\ch03_1 프로젝트 파일에 구현 `주석 3-2-1`

<hr>

### 3.1.3 Rect_ 클래스
- OpenCV에서 사각형의 위치와 크기 정보를 표현할 때에는 Rect_ 클래스를 사용
- Rect_ 클래스는 사각형의 좌측 상단 점의 좌표를 나타내는 x, y 맴버 변수와 사각형의 가로 및 세로 크기를 나타내는 width, height 맴버 변수를 가지고 있음
- 간략화한 Rect_ 클래스 정의를 src\ch03-1 프로젝트 파일에 구현 `주석 3-3`

<hr>

- Rect_ 클래스도 템플릿으로 정의되어 있으며, 다양한 자료형에 대해 이름이 재정의되어 있음
  - int 자료형을 이용하여 사각형 정보를 표현하려면 Rect2i 클래스를 사용하고, float 자료형으로 사각형을 표현하려면 Rect2f 클래스를 사용
- 정수형으로 사각형 정보를 표현하는 경우가 많기 때문에 Rect2i는 다시 Rect라는 이름으로 재정의되어 있음
  - 즉, Rect 클래스는 정수형 맴버 변수 x, y, width, height를 가지고 있는 사각형 표현 클래스

<hr>

- 2차원 정수 좌표계에서 사각형 정보를 표현하는 방법을 src\ch03_1 프로젝트 파일에 구현 `주석 3-3-1`

<hr>

### 3.1.4 RotatedRect 클래스
- RotatedRect 클래스는 회전된 사각형을 표현하는 클래스
- RotatedRect 클래스는 회전된 사각형의 중심 좌표를 나타내는 center, 사각형의 가로 및 세로 크기를 나타내는 size, 회전 각도 정보를 나타내는 angle을 맴버 변수로 가짐
- 간략화한 RotatedRect 클래스 정의를 src\ch03-1 프로젝트 파일에 구현 `주석 3-4`

<hr>

- RotatedRect 클래스는 Point_, Size_, Rect_ 클래스와 달리 템플릿 클래스가 아니며, 모든 정보를 float 자료형을 사용하여 표현
- 즉, 중심점 좌표는 Point2f 클래스를 사용하고, 크기 정보는 Size2f 클래스를 사용
- 회전 각도는 float 자료형을 사용

<hr>

- RotatedRect 클래스를 사용하는 코드 작성 방법을 src\ch03_1 프로젝트 파일에 구현 `주석 3-4-1`

<hr>

### 3.1.5 Range 클래스
- Range 클래스는 범위 또는 구간을 표현하는 클래스
- Range 클래스는 범위의 시작과 끝을 나타내는 start와 end 맴버 변수를 가지고 있음
- 간략화한 Range 클래스 정의를 src\ch03-1 프로젝트 파일에 구현 `주석 3-5`

<hr>

### 3.1.6 String 클래스
- 많은 C/C++ 프로그램이 그러하듯이 OpenCV에서도 문자열을 다루는 경우가 많음
- OpenCV에서는 영상 출력 창에 고유의 문자열을 지정하여 구분하고, 영상에 문자열을 출력하는 기능도 제공
- C++ 표준 라이브러리(STL)에서 std::string 클래스를 이용하여 문자열을 저장하고 처리하듯이 OpenCV에서는 cv::string 클래스를 사용하여 문자열을 저장하고 처리할 수 있음

<hr>

- 원래 OpenCV 라이브러리에서는 자체적인 String 클래스를 정의하여 사용했음
- String 클래스는 std::string 클래스와 완전히 호환되도록 설계되어 있어서 std::string 클래스를 다루는 방식과 유사하게 사용할 수 있었음
- 그러다가 OpenCV 4.0 버전부터는 자체적인 String 클래스 정의를 삭제하고, 대신 C++ 표준 라이브러리의 std::string 클래스를 String 클래스로 이름 재정의함
- 실제로 OpenCV 헤더 파일에는 다음과 같이 이름 재정의 코드가 들어가 있음
  
```typedef std::string String```
  
- 결국 OpenCV 4.0 버전부터 std::string 클래스와 String 클래스는 완전히 같은 클래스
- 다만 코드 호환성을 위하여 여전히 OpenCV 코드에서는 std::string 대신 String 클래스 이름을 사용

<hr>

- String 클래스를 사용하는 방법을 src\ch03_1 프로젝트 파일에 구현 `주석 3-6`

<hr>

- 만약 특정한 형식의 문자열을 만들고 싶다면 OpenCV에서 제공하는 format() 함수를 사용할 수 있음
- format() 함수 원형은 다음과 같음
> `String format(const char* fmt, ...);
> - fmt : 형식 문자열
> - ... : 가변 인자
> - 반환값 : 지정한 형식으로 생성된 문자열

- format() 함수는 가변 인자 함수로 정의되어 있으며 사용법은 C 언어의 printf() 함수와 유사
- 즉, C 언어에서 printf() 함수를 사용하듯이 함수의 인자를 설정하면 그에 해당하는 출력 문자열이 String 객체 형태로 반환
- 예를 들어 OpenCV 예제 프로그램에서 test01.bmp, test02.bmp, test03.bmp 세 개의 테스트 파일을 불러오고 싶을 때, 다음과 같은 코드를 이용하여 파일 이름에 해당하는 문자열을 생성할 수 있음
``` C++
Mat imgs[3];
for (int i = 0; i < 3; i++) {
    String filename = format("test%02d.bmp", i + 1);
    imgs[i] = imread(filename);
}
```

<hr>

## 3.2 Mat 클래스

### 3.2.1 Mat 클래스 개요

- OpenCV 라이브러리에서 가장 많이 사용하는 클래스는 단연 행렬을 표현하는 Mat 클래스
- Mat 클래스는 일반적인 2차원 행렬 뿐만 아니라 고차원 행렬을 표현할 수 있으며, 한 개 이상의 채널(channel)을 가질 수 있음
- Mat 클래스에는 정수, 실수, 복소수 등으로 구성된 행렬 또는 벡터(vector)를 저장할 수 있고, 그레이스케일 또는 컬러 영상을 저장할 수도 있음
- 경우에 따라서는 벡터 필드(vector field), 포인트 클라우드(point cloud), 텐서(tensor), 히스토그램(histogram) 등 정보를 저장하는 용도로 사용됨
- 그러나 실제적으로는 2차원 영상 데이터를 저장하고 처리하는 용도로 가장 많이 사용되고 있음

<hr>

- Mat 클래스는 <OPENCV_SRC>\modules\core\include\opencv2\core\mat.hpp 파일에 정의되어 있음
   - 여기서 <OPENCV_SRC>는 OpenCV 소스 코드가 있는 폴더 위치를 의미
- Mat 클래스 전체 정의에서 중요한 부분만 선별하여 간략화한 코드 예시를 src\ch03_2 프로젝트 파일에 구현 `주석 3-6`

<hr>

- OpenCV에서 Mat 행렬은 다양한 자료형의 원소를 가질 수 있음
- 또한 Mat 클래스의 원소는 하나의 값을 가질 수 있고, 또는 여러 개의 값이 모여서 하나의 원소로 표현되기도 함
- OpenCV는 C/C++ 기본 자료형 중에서 unsigned char, signed char, unsigned short, signed short, int, float, double 자료형을 사용하는 Mat 행렬을 지원
- OpenCV 4.0부터는 16비트 실수형 자료형도 사용할 수 있음
- Mat 클래스에서 행렬이 어떤 자료형을 사용하는지에 대한 정보를 깊이(depth)라고 부름
- OpenCV에서 Mat 행렬의 깊이는 다음과 같은 형식의 매크로 상수를 이용하여 표현
`CV_<bit-depth>{U|S|F}`
- 깊이 표현 매크로 상수 형식의 처음에 나타나는 CV_는 OpenCV를 나타내는 접두사와 같은 역할
- 그 뒤의 <bit-depth>에는 8, 16, 32, 64의 숫자를 지정할 수 있으며, 이는 원소 값 하나의 비트 수를 나타냄
- 그 다음 {U|S|F} 부분에는 U, S, F 세 문자 중 하나를 지정할 수 있음
- 여기서 U는 부호 없는 정수형, S는 부호 있는 정수형, F는 부동 소수형을 의미
- 실제로 OpenCV 라이브러리는 행렬의 깊이 표현을 위해 다음과 같은 매크로 상수를 정의하여 사용
  
``` C++
#define CV_8U   0      // uchar, unsigned char
#define CV_8S   1      // schar, singned char
#define CV_16U  2      // ushort, unsigned short
#define CV_16S  3      // signed short
#define CV_32S  4      // int
#define CV_32F  5      // float
#define CV_64S  6      // double
#define CV_16F  7      // float16_t
```
  
- 앞에 나열된 매크로 정의에서 오른편 주석 부분은 각각의 깊이 표현 매크로 상수와 대응되는 C/C++ 자료형을 나타냄
   - 예를 들어 Mat 행렬의 깊이가 CV_8U라는 것은 이 행렬의 원소가 unsigned char 자료형을 사용한다는 의미
   - 만약 행렬 원소를 float 자료형으로 표현하려면 깊이가 CV_32F인 행렬을 사용해야 함

<hr>

- Mat 행렬 원소는 하나의 값을 가질 수도 있고, 또는 여러 개로 구성된 값을 가질 수도 있음
- Mat 행렬 원소를 구성하는 각각의 값을 채널(channel)이라고 부름
- 즉, Mat 행렬은 하나의 채널을 가질 수도 있고, 여러 개의 채널을 가질 수도 있음
- 이때 하나의 행렬을 구성하는 각 채널은 모두 같은 자료형을 사용해야 함
- 예를 들어 그레이스케일 영상은 하나의 픽셀이 밝기 정보 하나만 사용하므로 1채널 행렬로 표현
- 반면에 트루컬러 영상은 픽셀이 파란색(B), 녹색(G), 빨간색(R) 세 개의 색상 정보를 가지고 있으므로 3채널 행렬로 표현
- OpenCV에서는 Mat 행렬의 깊이 정보와 채널 수 정보를 합쳐서 Mat 객체의 타입(type)이라고 부름 
- OpenCV 행렬의 타입은 다음과 같은 형식의 매크로 상수로 표현
`CV_<bit-depth>{U|S|F}C(<number_of_channels>)`
- 즉, Mat 행렬의 깊이 표현 매크로 뒤에 C1, C3 같은 채널 정보가 추가로 붙어 있는 형태
- 예를 들어 CV_8UC1 타입은 8비트 unsigned char 자료형을 사용하고 채널이 한 개인 행렬 또는 영상을 의미
- B, G, R 세 개의 색상 성분을 가지고 있는 컬러 영상은 unsigned char 자료형을 사용하고 세 개의 채널을 가지고 있기 때문에 CV_8UC3 타입
- 복소수처럼 두 개의 실수 값을 사용하는 행렬은 CV_32FC2 타입으로 만들 수 있음
- OpenCV에서 새로운 행렬을 생성할 때에는 행렬의 타입 정보를 명시적으로 지정해야 함

> - OpenCV는 C/C++에서 사용하는 기본 자료형의 이름을 typedef 구문을 이용하여 새롭게 정의하여 사용
>    - 예를 들어 OpenCV에서 uchar 자료형은 unsigned char를 재정의한 이름
> - 이처럼 C/C++ 기본 자료형에 새로운 이름을 부여하는 것은 키보드로 타이핑하기 쉽게 하려는 이유도 있지만 OpenCV 라이브러리를 다양한 운영 체제에서 통일성 있게 활용하기 위한 목적도 있음
> > **OpenCV에서 주로 사용하는 자료형과 그 의미**
> > - schar : 부호 있는 1바이트 정수
> > - uchar : 부호 없는 1바이트 정수
> > - short : 부호 있는 2바이트 정수 (C/C++ 기본 자료형)
> > - ushort : 부호 없는 2바이트 정수
> > - int : 부호 있는 4바이트 정수 (C/C++ 기본 자료형)
> > - uint : 부호 없는 4바이트 정수
> > - int64 : 부호 있는 8바이트 정수
> > - uint64 : 부호 없는 8바이트 정수
> > - float16_t : (부호 있는) 2바이트 실수
> > - float : (부호 있는) 4바이트 실수 (C/C++ 기본 자료형)
> > - double : (부호 있는) 8바이트 실수 (C/C++ 기본 자료형)
